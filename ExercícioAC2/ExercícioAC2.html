<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <title>Babylon.js sample code</title>

    <!-- Babylon.js -->
    <script src="https://code.jquery.com/pep/0.4.2/pep.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.2/dat.gui.min.js"></script>
    <script src="https://preview.babylonjs.com/ammo.js"></script>
    <script src="https://preview.babylonjs.com/cannon.js"></script>
    <script src="https://preview.babylonjs.com/Oimo.js"></script>
    <script src="https://preview.babylonjs.com/libktx.js"></script>
    <script src="https://preview.babylonjs.com/earcut.min.js"></script>
    <script src="https://preview.babylonjs.com/babylon.js"></script>
    <script src="https://preview.babylonjs.com/inspector/babylon.inspector.bundle.js"></script>
    <script src="https://preview.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>
    <script src="https://preview.babylonjs.com/proceduralTexturesLibrary/babylonjs.proceduralTextures.min.js"></script>
    <script src="https://preview.babylonjs.com/postProcessesLibrary/babylonjs.postProcess.min.js"></script>
    <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.js"></script>
    <script src="https://preview.babylonjs.com/serializers/babylonjs.serializers.min.js"></script>
    <script src="https://preview.babylonjs.com/gui/babylon.gui.min.js"></script>


    <style>
        html,
        body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #renderCanvas {
            width: 100%;
            height: 100%;
            touch-action: none;
        }
    </style>
</head>

<body>
    <canvas id="renderCanvas"></canvas>
    <script>
        var canvas = document.getElementById("renderCanvas");

        var engine = null;
        var scene = null;
        var createDefaultEngine = function () { return new BABYLON.Engine(canvas, true, { preserveDrawingBuffer: true, stencil: true }); };
        var btnif = true;

        var createScene = function () {
            // Create the scene space
            scene = new BABYLON.Scene(engine);
            createLights();
            createCamera();
            managerEvents();
            uiManeger();
            //MostrarEixos();

            return scene;
        }

        function uiManeger() {

            var ui = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("myUI");




            //Delete Button
            btnAdd = BABYLON.GUI.Button.CreateSimpleButton("btnAdd", "Deletar");

            btnAdd.top = "-40%";
            btnAdd.left = "500px";
            btnAdd.width = "200px";
            btnAdd.height = "50px";
            btnAdd.thickness = 4;
            btnAdd.textBlock.color = "#FDFEFE";
            btnAdd.textBlock.fontSize = 24;
            btnAdd.color = "#83DA47";
            btnAdd.background = "#000000"

            var onBtnAddClick = () => {
                if (btnif) {
                    btnAdd.textBlock.text = "Adicionar";
                    btnAdd.color = "#FF0023";
                    btnif = false;
                } else {
                    btnAdd.textBlock.text = "Deletar";
                    btnAdd.color = "#83DA47";
                    btnif = true;
                }

                console.log(btnif);
            }
            btnAdd.onPointerClickObservable.add(onBtnAddClick);

            var number = undefined;
            var input = new BABYLON.GUI.InputText();
            input.top = "40%";
            input.width = "100px";
            input.maxWidth = 0.2;
            input.height = "40px";
            input.text = "Tamanho!";
            input.color = "white";
            input.background = "green";

            input.onTextChangedObservable.add((input) => {
                let key = input.currentKey;
                if (key < "0" || key > "9") {
                    intput.addKey = false;
                } else {
                    number = input.text;
                    if (number <= 9 && input.text != "") {
                        createCubes(number);
                    }
                }
            });

            input.onPointerClickObservable.add(function () {
                input.text="";
            });

            ui.addControl(input);
            ui.addControl(btnAdd);
        }
        function MostrarEixos() {

            var showAxis = function (size) {
                var makeTextPlane = function (text, color, size) {
                    var dynamicTexture = new BABYLON.DynamicTexture("DynamicTexture", 50, scene, true);
                    dynamicTexture.hasAlpha = true;
                    dynamicTexture.drawText(text, 5, 40, "bold 36px Arial", color, "transparent", true);
                    var plane = new BABYLON.Mesh.CreatePlane("TextPlane", size, scene, true);
                    plane.material = new BABYLON.StandardMaterial("TextPlaneMaterial", scene);
                    plane.material.backFaceCulling = false;
                    plane.material.specularColor = new BABYLON.Color3(0, 0, 0);
                    plane.material.diffuseTexture = dynamicTexture;
                    return plane;
                };

                var axisX = BABYLON.Mesh.CreateLines("axisX", [
                    new BABYLON.Vector3.Zero(), new BABYLON.Vector3(size, 0, 0), new BABYLON.Vector3(size * 0.95, 0.05 * size, 0),
                    new BABYLON.Vector3(size, 0, 0), new BABYLON.Vector3(size * 0.95, -0.05 * size, 0)
                ], scene);
                axisX.color = new BABYLON.Color3(1, 0, 0);
                var xChar = makeTextPlane("X", "red", size / 10);
                xChar.position = new BABYLON.Vector3(0.9 * size, -0.05 * size, 0);
                var axisY = BABYLON.Mesh.CreateLines("axisY", [
                    new BABYLON.Vector3.Zero(), new BABYLON.Vector3(0, size, 0), new BABYLON.Vector3(-0.05 * size, size * 0.95, 0),
                    new BABYLON.Vector3(0, size, 0), new BABYLON.Vector3(0.05 * size, size * 0.95, 0)
                ], scene);
                axisY.color = new BABYLON.Color3(0, 1, 0);
                var yChar = makeTextPlane("Y", "green", size / 10);
                yChar.position = new BABYLON.Vector3(0, 0.9 * size, -0.05 * size);
                var axisZ = BABYLON.Mesh.CreateLines("axisZ", [
                    new BABYLON.Vector3.Zero(), new BABYLON.Vector3(0, 0, size), new BABYLON.Vector3(0, -0.05 * size, size * 0.95),
                    new BABYLON.Vector3(0, 0, size), new BABYLON.Vector3(0, 0.05 * size, size * 0.95)
                ], scene);
                axisZ.color = new BABYLON.Color3(0, 0, 1);
                var zChar = makeTextPlane("Z", "blue", size / 10);
                zChar.position = new BABYLON.Vector3(0, 0.05 * size, 0.9 * size);
            };

            showAxis(8);

        }

        function managerEvents() {
            scene.onPointerDown = function (evt, pickResult) {
                if (pickResult.hit && pickResult.pickedMesh.name == 'box') {
                    if (btnif) {
                        var newBox = pickResult.pickedMesh.clone();
                        newBox.position.y += 1;
                        newBox.name = "box";
                    } else {
                        pickResult.pickedMesh.dispose();
                    }


                }
            };
        }

        function createCamera() {
            var camera = new BABYLON.ArcRotateCamera("Camera", 1, 1, 15, BABYLON.Vector3.Zero(), scene);
            camera.attachControl(canvas, true);
        }

        function createCubes(size) {
            var metalMaterial = new BABYLON.StandardMaterial("MetalMaterial", scene);
            metalMaterial.ambientTexture = new BABYLON.Texture("Textures/MetalTexture.jpg", scene);
            var woodMaterial = new BABYLON.StandardMaterial("MetalMaterial", scene);
            woodMaterial.ambientTexture = new BABYLON.Texture("Textures/WoodTexture.jpg", scene);
            //metalMaterial.ambientTexture = new BABYLON.Texture("Textures/ChromeMetal.jpg", scene);
            //metalMaterial.diffuseColor = new BABYLON.Color3(1, 0, 0);
            var meshes = scene.getMeshesByID("box");
            meshes.forEach(function (mesh) {
                mesh.dispose();
            });

            for (let j = 0; j < size; j++) {
                for (let i = 0; i < size; i++) {
                    var box = BABYLON.MeshBuilder.CreateBox("box", {}, scene); // default box
                    box.id="box";
                    if (i % 2 == 0) {
                        if (j % 2 == 0) {
                            box.material = metalMaterial;
                        }
                        else if (j % 2 == 1) {
                            box.material = woodMaterial;
                        }
                    }
                    else if (i % 2 == 1) {
                        if (j % 2 == 1) {
                            box.material = metalMaterial;
                        }
                        else if (j % 2 == 0) {
                            box.material = woodMaterial;
                        }

                    }
                    box.position.x = i;
                    box.position.z = j;
                }

            }

        }



        function createLights() {
            var light1 = new BABYLON.PointLight("light", new BABYLON.Vector3(15, 10, 0), scene);
            var light2 = new BABYLON.PointLight("light", new BABYLON.Vector3(-15, 10, 0), scene);
            var light3 = new BABYLON.PointLight("light", new BABYLON.Vector3(0, 10, 15), scene);
            var light4 = new BABYLON.PointLight("light", new BABYLON.Vector3(0, 10, -15), scene);
        }

        engine = createDefaultEngine();
        if (!engine) throw 'engine should not be null.';
        scene = createScene();

        engine.runRenderLoop(function () {
            if (scene) {
                scene.render();
            }
        });

        // Resize
        window.addEventListener("resize", function () {
            engine.resize();
        });
    </script>
</body>

</html>